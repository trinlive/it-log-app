version: '3.8'

services:
  # 1. ส่วนของ App Node.js
  app:
    container_name: it-log-app
    build: .
    ports:
      - "3000:3000"
    environment:
      - PORT=3000
      - DB_HOST=db             # สำคัญ: ใน Docker ต้องเรียกชื่อ Service ว่า "db" ห้ามใช้ localhost
      - DB_USER=root
      - DB_PASS=gUm9LCWcag     # รหัสผ่านตามที่คุณระบุ
      - DB_NAME=itlogs
      - TZ=Asia/Bangkok        # ตั้งเวลาเครื่องเป็นไทย
    depends_on:
      - db                     # รอให้ Database ตื่นก่อนค่อยรัน App
    networks:
      - app-network
    restart: always

  # 2. ส่วนของ Database (MariaDB)
  db:
    image: mariadb:10.6        # ใช้ version เสถียร
    container_name: it-log-db
    environment:
      - MYSQL_ROOT_PASSWORD=gUm9LCWcag  # ต้องตรงกับ DB_PASS ข้างบน
      - MYSQL_DATABASE=itlogs           # สร้าง Database ชื่อนี้ให้อัตโนมัติ
      - TZ=Asia/Bangkok                 # ตั้งเวลา Database เป็นไทย
    volumes:
      - db_data:/var/lib/mysql          # เก็บข้อมูลถาวร (Volume)
    networks:
      - app-network
    restart: always

networks:
  app-network:

volumes:
  db_data: